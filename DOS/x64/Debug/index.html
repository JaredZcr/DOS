<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecOps Network Guard | DoS Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap');

        body {
            background-color: #0f172a;
            font-family: 'Inter', sans-serif;
            color: #e2e8f0;
        }

        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px currentColor; opacity: 1; }
            50% { box-shadow: 0 0 20px currentColor; opacity: 0.8; }
        }
        
        @keyframes critical-flash {
            0%, 100% { box-shadow: inset 0 0 0 transparent; }
            50% { box-shadow: inset 0 0 50px rgba(220, 38, 38, 0.5); }
        }

        .status-indicator {
            animation: pulse-glow 2s infinite;
        }

        .critical-alert {
            animation: critical-flash 1s infinite;
            border: 1px solid #ef4444 !important;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex flex-col gap-6 transition-colors duration-300" id="mainBody">
    <header class="flex justify-between items-center mb-4">
        <div class="flex items-center gap-3">
            <i class="ph-fill ph-shield-check text-4xl text-emerald-400" id="headerIcon"></i>
            <div>
                <h1 class="text-2xl font-bold tracking-tight text-white">Network Guard <span class="text-xs align-top text-cyan-400 px-1 border border-cyan-400 rounded ml-1">PRO</span></h1>
                <p class="text-slate-400 text-xs uppercase tracking-wider">Real-Time DoS Detection System</p>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <div class="hidden md:block text-right">
                <div class="text-xs text-slate-400">System Time</div>
                <div class="font-mono text-emerald-400" id="sysTime">--:--:--</div>
            </div>
            <div class="h-10 w-10 rounded-full bg-slate-800 flex items-center justify-center border border-slate-700">
                <div id="connectionDot" class="w-3 h-3 rounded-full bg-red-500 status-indicator"></div>
            </div>
        </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div id="statusCard" class="glass-card rounded-xl p-6 flex flex-col justify-between border-l-4 border-emerald-500 transition-all duration-300">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm text-slate-400 font-medium uppercase">System Status</p>
                    <h2 id="statusText" class="text-3xl font-bold text-white mt-2">SECURE</h2>
                </div>
                <div class="p-3 bg-slate-800 rounded-lg text-emerald-400" id="statusIconBg">
                    <i class="ph-fill ph-lock-key text-2xl" id="statusIconMain"></i>
                </div>
            </div>
            <div class="mt-4">
                <span id="statusDetail" class="text-xs font-mono text-emerald-300 bg-emerald-900/30 px-2 py-1 rounded">Traffic Normal</span>
            </div>
        </div>

        <div class="glass-card rounded-xl p-6 flex flex-col justify-between border-l-4 border-cyan-500">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm text-slate-400 font-medium uppercase">Current Load</p>
                    <div class="flex items-baseline gap-2 mt-2">
                        <h2 id="ppsValue" class="text-4xl font-bold text-white font-mono">0</h2>
                        <span class="text-sm text-cyan-400 font-bold">PPS</span>
                    </div>
                </div>
                <div class="p-3 bg-slate-800 rounded-lg text-cyan-400">
                    <i class="ph-fill ph-activity text-2xl"></i>
                </div>
            </div>
            <div class="w-full bg-slate-800 h-2 rounded-full mt-4 overflow-hidden">
                <div id="loadBar" class="bg-cyan-500 h-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <div class="glass-card rounded-xl p-6 flex flex-col justify-between border-l-4 border-violet-500">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm text-slate-400 font-medium uppercase">Session Peak</p>
                    <div class="flex items-baseline gap-2 mt-2">
                        <h2 id="peakValue" class="text-4xl font-bold text-white font-mono">0</h2>
                        <span class="text-sm text-violet-400 font-bold">PPS</span>
                    </div>
                </div>
                <div class="p-3 bg-slate-800 rounded-lg text-violet-400">
                    <i class="ph-fill ph-chart-bar text-2xl"></i>
                </div>
            </div>
            <div class="mt-4 text-xs text-slate-400">
                Highest traffic detected since boot.
            </div>
        </div>
    </div>

    <div class="glass-card rounded-xl p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                <i class="ph ph-trend-up text-cyan-400"></i> Traffic Analysis
            </h3>
            <div class="flex gap-2 text-xs">
                <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-cyan-500"></span> Packets</span>
                <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-500"></span> Alert Threshold</span>
            </div>
        </div>
        <div class="relative h-64 w-full">
            <canvas id="trafficChart"></canvas>
        </div>
    </div>
    <div class="glass-card rounded-xl p-6 flex-grow flex flex-col">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <i class="ph ph-list-dashes text-slate-400"></i> Event Log
        </h3>
        <div class="overflow-y-auto flex-grow max-h-60 pr-2" id="logContainer">
            <div class="text-center text-slate-500 py-8 italic">Waiting for data stream...</div>
        </div>
    </div>

    <footer class="text-center text-xs text-slate-600 mt-auto">
        <p>C-Based Packet Capture Engine â€¢ WebSocket / File Polling Interface</p>
        <p id="dataSource" class="mt-1 text-slate-700">Source: dos_status.txt</p>
    </footer>

<script>
    const CONFIG = {
        dataFile: 'dos_status.txt',
        pollInterval: 1000,
        maxChartPoints: 40,
        demoMode: false
    };

    let peakTraffic = 0;
    let isAttackActive = false;
    let chartInstance = null;
    let demoInterval = null;

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();
    
    function playAlertSound() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.setValueAtTime(880, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.5);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.5);
    }

    function initChart() {
        const ctx = document.getElementById('trafficChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(6, 182, 212, 0.5)');
        gradient.addColorStop(1, 'rgba(6, 182, 212, 0)');

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Packets/Sec',
                    data: [],
                    borderColor: '#06b6d4',
                    backgroundColor: gradient,
                    borderWidth: 2,
                    pointRadius: 0,
                    pointHoverRadius: 4,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                interaction: { intersect: false, mode: 'index' },
                plugins: { legend: { display: false } },
                scales: {
                    x: {
                        display: false,
                        grid: { display: false }
                    },
                    y: {
                        border: { display: false },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#94a3b8' },
                        beginAtZero: true
                    }
                }
            }
        });
    }

    function updateDashboard(timestamp, packets, isAttack) {
        const now = new Date();
        document.getElementById('sysTime').innerText = now.toLocaleTimeString();
        document.getElementById('connectionDot').style.backgroundColor = '#10b981';
        document.getElementById('connectionDot').classList.add('status-indicator');

        if (chartInstance.data.labels.length > CONFIG.maxChartPoints) {
            chartInstance.data.labels.shift();
            chartInstance.data.datasets[0].data.shift();
        }
        chartInstance.data.labels.push(now.toLocaleTimeString());
        chartInstance.data.datasets[0].data.push(packets);
        
        if (isAttack) {
            chartInstance.data.datasets[0].borderColor = '#ef4444';
            chartInstance.data.datasets[0].backgroundColor = 'rgba(239, 68, 68, 0.2)';
        } else {
            chartInstance.data.datasets[0].borderColor = '#06b6d4';
            const ctx = document.getElementById('trafficChart').getContext('2d');
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(6, 182, 212, 0.5)');
            gradient.addColorStop(1, 'rgba(6, 182, 212, 0)');
            chartInstance.data.datasets[0].backgroundColor = gradient;
        }
        chartInstance.update();

        const ppsEl = document.getElementById('ppsValue');
        ppsEl.innerText = packets;
        
        if (packets > peakTraffic) {
            peakTraffic = packets;
            document.getElementById('peakValue').innerText = peakTraffic;
        }

        const loadPercent = Math.min((packets / 2000) * 100, 100);
        const loadBar = document.getElementById('loadBar');
        loadBar.style.width = `${loadPercent}%`;
        loadBar.classList.toggle('bg-red-500', isAttack);
        loadBar.classList.toggle('bg-cyan-500', !isAttack);

        const body = document.getElementById('mainBody');
        const statusCard = document.getElementById('statusCard');
        const statusText = document.getElementById('statusText');
        const statusDetail = document.getElementById('statusDetail');
        const statusIconMain = document.getElementById('statusIconMain');
        const statusIconBg = document.getElementById('statusIconBg');
        const headerIcon = document.getElementById('headerIcon');

        if (isAttack) {
            if (!isAttackActive) playAlertSound();
            isAttackActive = true;

            body.classList.add('critical-alert');
            statusCard.className = "glass-card rounded-xl p-6 flex flex-col justify-between border-l-4 border-red-500 transition-all duration-300 bg-red-900/20";
            statusText.innerText = "ATTACK DETECTED";
            statusText.classList.replace('text-white', 'text-red-500');
            statusDetail.innerText = "Threshold Exceeded";
            statusDetail.className = "text-xs font-mono text-red-200 bg-red-900/50 px-2 py-1 rounded animate-pulse";
            statusIconBg.className = "p-3 bg-red-900 rounded-lg text-red-400 animate-bounce";
            statusIconMain.className = "ph-fill ph-warning-octagon text-2xl";
            headerIcon.className = "ph-fill ph-shield-warning text-4xl text-red-500 animate-pulse";
        } else {
            isAttackActive = false;
            body.classList.remove('critical-alert');

            statusCard.className = "glass-card rounded-xl p-6 flex flex-col justify-between border-l-4 border-emerald-500 transition-all duration-300";
            statusText.innerText = "SECURE";
            statusText.classList.replace('text-red-500', 'text-white');
            statusDetail.innerText = "Traffic Normal";
            statusDetail.className = "text-xs font-mono text-emerald-300 bg-emerald-900/30 px-2 py-1 rounded";
            statusIconBg.className = "p-3 bg-slate-800 rounded-lg text-emerald-400";
            statusIconMain.className = "ph-fill ph-lock-key text-2xl";
            headerIcon.className = "ph-fill ph-shield-check text-4xl text-emerald-400";
        }

        addLogEntry(timestamp, packets, isAttack);
    }
    function addLogEntry(timestamp, packets, isAttack) {
        const container = document.getElementById('logContainer');

        if (container.children.length > 0 && container.children[0].innerText.includes('Waiting')) {
            container.innerHTML = '';
        }

        const div = document.createElement('div');
        div.className = "flex items-center justify-between py-2 border-b border-slate-700/50 text-sm font-mono hover:bg-slate-800/50 px-2 rounded";
        
        const icon = isAttack ? '<i class="ph-fill ph-warning text-red-500 mr-2"></i>' : '<i class="ph-fill ph-check-circle text-slate-600 mr-2"></i>';
        const colorClass = isAttack ? 'text-red-400 font-bold' : 'text-slate-300';
        
        let timeStr = timestamp;
        if (!isNaN(timestamp) && timestamp > 1000000000) {
            timeStr = new Date(parseInt(timestamp) * 1000).toLocaleTimeString();
        }

        div.innerHTML = `
            <div class="flex items-center">
                ${icon}
                <span class="text-slate-500 mr-3">[${timeStr}]</span>
                <span class="${colorClass}">${isAttack ? 'DoS THREAT DETECTED' : 'Routine Scan'}</span>
            </div>
            <div class="${isAttack ? 'text-red-500' : 'text-cyan-600'}">${packets} pkts</div>
        `;
        
        container.prepend(div);

        if (container.children.length > 50) {
            container.lastElementChild.remove();
        }
    }

    async function fetchData() {
        if (CONFIG.demoMode) {
            simulateData();
            return;
        }

        try {
            const response = await fetch(CONFIG.dataFile + '?_=' + Date.now());
            if (!response.ok) throw new Error("File not found");
            
            const text = await response.text();
            const lines = text.trim().split('\n');
            if (lines.length === 0) return;

            const lastLine = lines[lines.length - 1];
            const parts = lastLine.split(',');

            let timestamp = new Date().toLocaleTimeString();
            let count = 0;
            let isAttack = false;

            if (parts.length >= 2) {
                timestamp = parts[0];
                count = parseInt(parts[1]);
                isAttack = parts.length >= 3 ? parseInt(parts[2]) === 1 : false;
            }

            updateDashboard(timestamp, count, isAttack);

        } catch (error) {
            console.warn("Fetch failed, switching to Demo Mode for preview...", error);
            document.getElementById('dataSource').innerHTML =
                '<span class="text-yellow-500"><i class="ph-fill ph-warning"></i> Demo Mode (File Not Accessible)</span>';
            document.getElementById('connectionDot').style.backgroundColor = '#eab308';
            CONFIG.demoMode = true;
        }
    }

    function simulateData() {
        const now = Math.floor(Date.now() / 1000);
        let count = Math.floor(Math.random() * 300) + 50; 
        const randomChance = Math.random();
        let isAttack = false;
        
        if (randomChance > 0.90) {
            count = Math.floor(Math.random() * 2000) + 1200;
            isAttack = true;
        }

        updateDashboard(now, count, isAttack);
    }

    window.onload = () => {
        initChart();
        setInterval(fetchData, CONFIG.pollInterval);
    };
</script>
</body>
</html>



